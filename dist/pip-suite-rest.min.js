!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pip||(t.pip={})).rest=e()}}(function(){return function i(a,s,c){function u(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(p)return p(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return u(a[t][1][e]||e)},o,o.exports,i,a,s,c)}return s[t].exports}for(var p="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,i){"use strict";o.$inject=["$httpProvider"],Object.defineProperty(i,"__esModule",{value:!0}),i.UnauthorizedRedirect="pipUnauthorizedRedirect",i.AccessDenyRedirect="pipAccessDenyRedirect";var r=(n.$inject=["$q","$rootScope","$location","$log"],n);function n(e,t,r,n){var o=this;this.$q=e,this.$rootScope=t,this.$location=r,this.$log=n,this.responseError=function(e){var t=o.$rootScope[pip.services.StateVar]&&o.$rootScope[pip.services.StateVar].name?o.$rootScope[pip.services.StateVar].name:null,r=o.$rootScope[pip.services.StateVar]&&o.$rootScope[pip.services.StateVar].params?o.$rootScope[pip.services.StateVar].params:null;switch(e.status){case 401:case 440:o.$log.error("Response Error 401",e),o.$rootScope.$emit(i.UnauthorizedRedirect,{redirect_to:t&&r&&r.redirect_to?"":o.$location.url(),toState:t,toParams:r});break;case 403:o.$log.error("Response Error 403",e),o.$rootScope.$emit(i.AccessDenyRedirect);break;default:o.$log.error("errors_unknown",e)}return o.$q.reject(e)}}function o(e){e.interceptors.push("pipAuthHttpResponseInterceptor")}angular.module("pipAuthState").config(o).service("pipAuthHttpResponseInterceptor",r)},{}],2:[function(e,t,r){"use strict";o.$inject=["$delegate","$timeout"],i.$inject=["$provide"],Object.defineProperty(r,"__esModule",{value:!0});var n=e("./IAuthStateService");function o(e,t){return e.config=new n.AuthStateConfig,e.signinState=function(e){e&&(this._config.signinState=e);return this._config.signinState},e.signoutState=function(e){e&&(this._config.signoutState=e);return this._config.signoutState},e.authorizedState=function(e){e&&(this._config.authorizedState=e);return this._config.authorizedState},e.unauthorizedState=function(e){e&&(this._config.unauthorizedState=e);return this._config.unauthorizedState},e.goToSignin=function(e){if(null==this._config.signinState)throw new Error("Signin state was not defined");e=function(e){return e&&e.toParams&&(e.server_url=e.toParams.server_url?e.toParams.server_url:null,e.email=e.toParams.email?e.toParams.email:null,e.language=e.toParams.language?e.toParams.language:"en"),e}(e),this.go(this._config.signinState,e)},e.goToSignout=function(e){if(null==this._config.signoutState)throw new Error("Signout state was not defined");this.go(this._config.signoutState,e)},e.goToAuthorized=function(e){if(null==this._config.authorizedState)throw new Error("Authorized state was not defined");this.go(this._config.authorizedState,e)},e.goToUnauthorized=function(e){if(null==this._config.unauthorizedState)throw new Error("Signin state was not defined");this.go(this._config.unauthorizedState,e)},e}function i(e){e.decorator("pipAuthState",o)}angular.module("pipAuthState").config(i)},{"./IAuthStateService":5}],3:[function(e,t,r){"use strict";function n(e,a,t,s,c){a.$on("$stateChangeStart",function(e,t,r,n,o){if(c.redirect&&c.redirect(e,t,r,a))return;if((t.auth||void 0===t.auth)&&!s.isOpened()){e.preventDefault();var i=c.href(t.name,r);return 0<i.length&&"#"==i[0]&&(i=i.substring(1)),void c.goToSignin({redirect_to:i,toState:t,toParams:r})}if(t.name==c.unauthorizedState()&&s.isOpened())return e.preventDefault(),void c.goToAuthorized({})}),a.$on("pipUnauthorizedRedirect",function(e,t){c.goToSignout(t)}),a.$on("$stateChangeSuccess",function(e,t,r,n,o){a[pip.services.RoutingVar]=!1})}function o(e){e.translations("en",{ERROR_SWITCHING:"Error while switching route. Try again."}),e.translations("ru",{ERROR_SWITCHING:"Ошибка при переходе. Попробуйте ещё раз."})}o.$inject=["pipTranslateProvider"],n.$inject=["$log","$rootScope","$state","pipSession","pipAuthState"],Object.defineProperty(r,"__esModule",{value:!0}),angular.module("pipAuthState").config(o).run(n)},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./IAuthStateService"),o=(i.$inject=["$stateProvider"],i.prototype.redirect=function(e,t){this._redirectedStates[e]=t},Object.defineProperty(i.prototype,"signinState",{get:function(){return this._config.signinState},set:function(e){this._config.signinState=e||null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"signoutState",{get:function(){return this._config.signoutState},set:function(e){this._config.signoutState=e||null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"authorizedState",{get:function(){return this._config.authorizedState},set:function(e){this._config.authorizedState=e||"/"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"unauthorizedState",{get:function(){return this._config.unauthorizedState},set:function(e){this._config.unauthorizedState=e||"/"},enumerable:!0,configurable:!0}),i.prototype.$get=["$state","$timeout",function(e,i){return null==this._service&&(e._config=this._config,e._redirectedStates=this._redirectedStates,e.redirect=function(e,t,r){var n=this,o=this._redirectedStates[t.name];if(_.isFunction(o)&&(o=o(t.name,r),_.isNull(o)))throw new Error("Redirected toState cannot be null");return!!o&&(i(function(){e.preventDefault(),n.transitionTo(o,r,{location:"replace"})}),!0)}),this._service=e,this._service}],i);function i(e){var r=this;this.$stateProvider=e,this._redirectedStates={},this._config=new n.AuthStateConfig,this.state=function(e,t){if(null==e)throw new Error("stateName cannot be null");if(null==t)throw new Error("stateConfig cannot be null");return t&&(t.auth||t.authenticate)&&(t.resolve=t.resolve||{}),r.$stateProvider.state(e,t),r}}angular.module("pipAuthState").provider("pipAuthState",o)},{"./IAuthStateService":5}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){this.signinState=null,this.signoutState=null,this.authorizedState="/",this.unauthorizedState="/"}r.AuthStateConfig=n},{}],6:[function(e,t,r){"use strict";function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),angular.module("pipAuthState",["ngResource","pipServices","LocalStorageModule"]),e("./AuthHttpResponseInterceptor"),e("./AuthStateDecorator"),e("./AuthStateInit"),e("./IAuthStateService"),e("./AuthStateService"),n(e("./AuthHttpResponseInterceptor")),n(e("./IAuthStateService"))},{"./AuthHttpResponseInterceptor":1,"./AuthStateDecorator":2,"./AuthStateInit":3,"./AuthStateService":4,"./IAuthStateService":5}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(o.$inject=["$q","pipDataModel"],o.prototype.hash=function(e){var t={};null!=e&&(t.filter=e.filter,t.search=e.search,t.start=e.start,t.take=e.take,t.skip=e.skip);var r=angular.toJson(t);if(null==r||0===r.length)return 0;for(var n=0,o=0,i=r.length;o<i;o++)n=(n<<5)-n+r.charCodeAt(o),n|=0;return n},o.prototype.generateKey=function(e,t){var r=this.hash(t);return e+(0!=r?"_"+r:"")},o.prototype.clear=function(e){if(null==e)this._cache={};else for(var t in this._cache)t!=e&&!t.startsWith(e+"_")||delete this._cache[t]},o.prototype.retrieve=function(e,t){if(null==e)throw new Error("Resource cannot be null");if(""==e)throw new Error("Resource cannot be empty");var r=this.generateKey(e,t),n=this._cache[r];return null==n?null:n.expire&&_.now()-n.expire>this.CACHE_TIMEOUT?(delete this._cache[r],null):n.data},o.prototype.store=function(e,t,r){if(null==e)throw new Error("Resource cannot be null");if(""==e)throw new Error("Resource cannot be empty");this._cache[this.generateKey(e,r)]={expire:_.now(),data:t}},o.prototype.storePermanently=function(e,t,r){if(null==e)throw new Error("Resource cannot be null");if(""==e)throw new Error("Resource cannot be empty");this._cache[this.generateKey(e,r)]={expire:null,data:t}},o.prototype.remove=function(e,t){if(null==e)throw new Error("Resource cannot be null");if(""==e)throw new Error("Resource cannot be empty");delete this._cache[this.generateKey(e,t)]},o.prototype.updateOne=function(e,t,r){if(null==e)throw new Error("Resource cannot be null");if(null!=t){var n=this.retrieve(e,r);if(null!=n){for(var o=!1,i=n.length,a=0;a<i;a++)if(n[a].id==t.id)return n[a]=t,void(o=!0);o||n.push(t),this.store(e,n,r)}}},o.prototype.retrieveOrLoad=function(t,r,n){var o=this;if(null==t)throw new Error("params cannot be null");var e,i=t.resource,a=t.filter,s=t.force?null:this.retrieve(i,t),c=this.$q.defer();return e=t.paging?"page":t.singleResult?"readOne":"read",s?(a&&(s.data?s.data=a(s.data):s=a(s)),_.isFunction(r)&&r(s),c.resolve(s)):this.pipDataModel[e](t,function(e){t.updatedItem?o.updateOne(i,e,t):o.store(i,e,t),a&&(e=a(e)),c.resolve(e),_.isFunction(r)&&r(e)},function(e){c.reject(e),_.isFunction(n)&&n(e)}),c.promise},o.prototype.removeOne=function(e,t){if(null==e)throw new Error("Resource cannot be null");if(null!=t)for(var r in this._cache)if(r==e||r.startsWith(e+"_")){var n=this._cache[r].data;if(angular.isArray(n))for(var o=0;o<n.length;o++)n[o].id==t.id&&(n.splice(o,1),o--)}},o.prototype.decorateAddCallback=function(t,r,n){var o=this;return function(e){r&&r.notClearedCache||o.clear(t),_.isFunction(n)&&n(e)}},o.prototype.decorateRemoveCallback=function(t,r,n){var o=this;return function(e){o.removeOne(t,r),_.isFunction(n)&&n(e)}},o.prototype.decorateUpdateCallback=function(o,e,i){var a=this;return function(e){for(var t in a._cache)if(t==o||t.startsWith(o+"_")){var r=a._cache[t].data;if(angular.isArray(r))for(var n=0;n<r.length;n++)r[n].id==e.id&&(r[n]=e)}_.isFunction(i)&&i(e)}},o.prototype.setTimeout=function(e){return e&&(this.CACHE_TIMEOUT=e),this.CACHE_TIMEOUT},o);function o(e,t){this.$q=e,this.pipDataModel=t,this.CACHE_TIMEOUT=6e5,this._cache={}}var i=(a.prototype.$get=["$q","pipDataModel",function(e,t){return null==this._service&&(this._service=new n(e,t)),this._service}],a);function a(){}angular.module("pipDataCache",[]).provider("pipDataCache",i)},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){}r.CacheParams=n},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),angular.module("pipDataCache",["pipDataModel"]),e("./DataCacheService"),e("./IDataCacheService"),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./IDataCacheService"))},{"./DataCacheService":7,"./IDataCacheService":8}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(o.$inject=["$stateParams","pipRest"],o.prototype.execute=function(t,r,n){var o,i=t.transaction;if(!i||t.skipTransactionBegin||(o=t.transactionId=i.begin(t.transactionOperation||"PROCESSING")))return this.pipRest.getResource(t.resource)[t.operation](t.item,function(e){i&&o&&i.aborted(o)||(i&&!t.skipTransactionEnd&&i.end(),r&&r(e))},function(e){i&&i.end(e),n&&n(e)})},o.prototype.create=function(t,r,n){return t.transactionOperation=t.transactionOperation||"SAVING",t.operation=t.operation||"save",this.execute(t,function(e){t.itemCollection&&t.itemCollection.push(e),r&&r(e)},function(e){n&&n(e)})},o.prototype.update=function(r,n,t){return r.transactionOperation=r.transactionOperation||"SAVING",r.operation=r.operation||"update",this.execute(r,function(t){if(r.itemCollection)var e=_.findIndex(r.itemCollection,function(e){return e.id==t.id});-1<e&&(r.itemCollection[e]=t),n&&n(t)},function(e){t&&t(e)})},o.prototype.delete=function(t,r,n){return t.transactionOperation=t.transactionOperation||"SAVING",t.operation=t.operation||"remove",this.execute(t,function(e){t.itemCollection&&_.remove(t.itemCollection,{id:e.id||(t.object||{}).id||(t.item||{}).id}),r&&r(e)},function(e){n&&n(e)})},o.prototype.read=function(e,t,r){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"query",this.execute(e,function(e){t&&t(e)},function(e){r&&r(e)})},o.prototype.readOne=function(r,n,t){return r.transactionOperation=r.transactionOperation||"READING",r.operation=r.operation||"page",this.execute(r,function(e){if(r.itemCollection&&e){var t=_.findIndex(r.itemCollection,{id:e.id});0<=t?r.itemCollection[t]=e:r.itemCollection.push(e)}n&&n(e)},function(e){t&&t(e)})},o.prototype.page=function(r,n,t){return r.transactionOperation=r.transactionOperation||"READING",r.operation=r.operation||"page",this.execute(r,function(e){if(r.itemCollection&&e.data)for(var t=0;t<e.data.length;t++)r.itemCollection.push(e.data[t]);n&&n(e)},function(e){t&&t(e)})},o.prototype.uploadFiles=function(t,r,n){var o,i=t.transaction;if(!i||t.skipTransactionBegin||(o=t.transactionId=i.begin(t.transactionOperation||"SAVING"))){var e=[{pictures:t.pictures,documents:t.documents}];if(t.item&&t.item.content){var a=!0;async.eachSeries(_.union(t.item.content,e),function(e,t){e.pictures||e.documents?e.pictures?e.pictures.save(function(){i&&o&&i.aborted(o)&&(a=!1,t("aborted")),e.documents?e.documents.save(function(){i&&o&&i.aborted(o)&&(a=!1,t("aborted")),t()},function(e){a=!1,t(e)}):t()},function(e){a=!1,t(e)}):e.documents&&e.documents.save(function(){i&&o&&i.aborted(o)&&(a=!1,t("aborted")),t()},function(e){a=!1,t(e)}):t()},function(e){!e&&a?(i&&!t.skipTransactionEnd&&i.end(),_.each(t.item.content,function(e){delete e.pictures,delete e.documents}),r&&r()):(i&&i.end(e),n&&n(e))})}else t.pictures?t.pictures.save(function(){i&&o&&i.aborted(o)||(t.documents?t.documents.save(function(){i&&o&&i.aborted(o)||(i&&!t.skipTransactionEnd&&i.end(),r&&r())},function(e){i&&i.end(e),n&&n(e)}):(i&&!t.skipTransactionEnd&&i.end(),r&&r()))},function(e){i&&i.end(e),n&&n(e)}):t.documents?t.documents.save(function(){i&&o&&i.aborted(o)||(i&&!t.skipTransactionEnd&&i.end(),r&&r())},function(e){i&&i.end(e),n&&n(e)}):(i&&!t.skipTransactionEnd&&i.end(),r&&r())}},o.prototype.abortFilesUpload=function(e){e.pictures&&e.pictures.abort(),e.documents&&e.documents.abort(),e.transaction&&e.transaction.abort()},o);function o(e,t){this.$stateParams=e,this.pipRest=t,this.save=this.update,this.remove=this.delete,this.query=this.read,this.get=this.readOne,this.readPage=this.page,this.queryPage=this.page}var i=(a.prototype.$get=["$stateParams","pipRest",function(e,t){return null==this._service&&(this._service=new n(e,t)),this._service}],a);function a(){}angular.module("pipDataModel").provider("pipDataModel",i)},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),angular.module("pipDataModel",["pipRest"]),e("./IDataModelService"),e("./DataModelService")},{"./DataModelService":10,"./IDataModelService":11}],13:[function(e,t,r){"use strict";function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),e("./rest"),e("./data"),e("./cache"),e("./auth_state"),angular.module("pipCommonRest",["pipDataCache","pipRest","pipDataModel","pipAuthState"]),n(e("./cache")),n(e("./auth_state"))},{"./auth_state":6,"./cache":9,"./data":12,"./rest":16}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(o.$inject=["$resource","$http","$stateParams","serverUrl","lockServerUrl","resourceConfigs"],o.prototype.reInitResource=function(){this._resources={},this.initResources(this.resourceConfigs)},o.prototype.initResources=function(e){var r=this;_.each(e,function(e){var t;switch(e.operation){case"createResource":t=r.createResource(r._serverUrl,e.path,e.defaultParams,e.actions);break;case"createOperation":t=r.createOperation(r._serverUrl,e.path);break;case"createCollection":t=r.createCollection(r._serverUrl,e.path,e.defaultParams);break;case"createPagedCollection":t=r.createPagedCollection(r._serverUrl,e.path,e.defaultParams);break;case"createPartyCollection":t=r.createPartyCollection(r._serverUrl,e.path,e.defaultParams)}t&&(r._resources[e.name]=t)})},o.prototype.createResource=function(e,t,r,n){return e=e||this._serverUrl,this.$resource(this._serverUrl+t,r,n)},o.prototype.createOperation=function(e,t){return e=e||this._serverUrl,this.$resource(e+t,{},{call:{method:"POST"}})},o.prototype.createCollection=function(e,t,r){return e=e||this._serverUrl,this.$resource(e+t,r||{id:"@id"},{update:{method:"PUT"}})},o.prototype.createPagedCollection=function(e,t,r){return e=e||this._serverUrl,this.$resource(e+t,r||{id:"@id"},{page:{method:"GET",isArray:!1},update:{method:"PUT"}})},o.prototype.createPartyCollection=function(e,t,r){return this.createPagedCollection(e,t,r||{id:"@id",party_id:"@party_id"})},Object.defineProperty(o.prototype,"serverUrl",{get:function(){return this._serverUrl},set:function(e){this._serverUrl=e,this.reInitResource()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lockServerUrl",{get:function(){return this._lockServerUrl},set:function(e){this._lockServerUrl=e},enumerable:!0,configurable:!0}),o.prototype.setHeaders=function(e){for(var t in e)e.hasOwnProperty(t)&&!_.isObject(e[t])&&(this.$http.defaults.headers.common[t]=e[t])},o.prototype.getResource=function(e){var t=this._resources[e];if(!t)throw new Error("Resource not found");return t},o);function o(e,t,r,n,o,i){this.$resource=e,this.$http=t,this.$stateParams=r,this.resourceConfigs=i,this._resources={},this._serverUrl=n,this._lockServerUrl=o,this.initResources(i)}var i=(a.$inject=["$httpProvider"],Object.defineProperty(a.prototype,"serverUrl",{get:function(){return this._serverUrl},set:function(e){this._serverUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lockServerUrl",{get:function(){return this._lockServerUrl},set:function(e){this._lockServerUrl=e},enumerable:!0,configurable:!0}),a.prototype.setHeaders=function(e){for(var t in e)e.hasOwnProperty(t)&&(this._http.defaults.headers.common[t]=e[t])},a.prototype.registerResource=function(e,t,r,n){this._resourceConfigs.push({operation:"createResource",name:e,path:t,defaultParams:r||null,actions:n||null})},a.prototype.registerOperation=function(e,t,r,n){this._resourceConfigs.push({operation:"createOperation",name:e,path:t,defaultParams:r||null,actions:n||null})},a.prototype.registerCollection=function(e,t,r,n){this._resourceConfigs.push({operation:"createCollection",name:e,path:t,defaultParams:r||null,actions:n||null})},a.prototype.registerPagedCollection=function(e,t,r,n){this._resourceConfigs.push({operation:"createPagedCollection",name:e,path:t,defaultParams:r||null,actions:n||null})},a.prototype.registerPartyCollection=function(e,t,r,n){this._resourceConfigs.push({operation:"createPartyCollection",name:e,path:t,defaultParams:r||null,actions:n||null})},a.prototype.$get=["$resource","$http","$stateParams",function(e,t,r){return null==this._service&&(this._service=new n(e,t,r,this._serverUrl,this._lockServerUrl,this._resourceConfigs)),this._service}],a);function a(e){this._resourceConfigs=[],this._http=e}angular.module("pipRest").provider("pipRest",i)},{}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),angular.module("pipRest",["ngResource"]),e("./IRestService"),e("./RestService")},{"./IRestService":14,"./RestService":15}]},{},[13])(13)});
//# sourceMappingURL=pip-suite-rest.min.js.map
